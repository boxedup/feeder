<?xml version="1.0" standalone="no"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <xsl:template match="<%= mappings["products"] %>">
    <products>
      <xsl:for-each select="<%= mappings["product"] %>">
        <product>
          <sku><xsl:value-of select="<%= mappings["sku"] %>"/></sku>
          <% unless mappings["category"].nil? %><category><xsl:value-of select="<%= mappings["category"] %>"/></category><% end %>
          <price xml:space="preserve"><xsl:value-of select="<%= mappings["price"] %>"/><% unless mappings["currency"].nil? %> <xsl:value-of select="<%= mappings["currency"] %>"/><% end %></price>
          <images>
            <%= "<xsl:for-each select=\"#{mappings["images_group"]}\">" unless mappings["images_group"].nil? %>
              <image_url><xsl:value-of select="<%= mappings["image_url"] %>"/></image_url>
            <%= "</xsl:for-each>" unless mappings["images_group"].nil? %>
          </images>
          <name><xsl:value-of select="<%= mappings["name"] %>"/></name>
          <description><xsl:value-of select="<%= mappings["description"] %>"/></description>
          <deep_link><xsl:value-of select="<%= mappings["deep_link"] %>"/></deep_link>
        </product>
      </xsl:for-each>
    </products>
  </xsl:template>
</xsl:stylesheet>